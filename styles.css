/* ========== Base / Reset ========== */
* { box-sizing: border-box; }
html, body { height: 100%; }
:root{
  --bg:#f6f7fb;
  --card:#fff;
  --ink:#111;
  --muted:#657085;
  --line:#e7e9f2;
  --accent:#5b5bf0;
  --accent-strong:#4b4be0;
  --shadow:0 10px 25px rgba(16,24,40,.08), 0 2px 6px rgba(16,24,40,.05);
  --radius-xl:20px;
  --radius-lg:16px;
  --radius-md:12px;
  --radius-sm:10px;
  --blur:20px;
  --font-scale:1;
}
.theme-dark{
  --bg:#0f1115;
  --card:#151923;
  --ink:#f4f6fb;
  --muted:#9aa3b2;
  --line:#252b36;
  --shadow:0 10px 25px rgba(0,0,0,.45), 0 2px 6px rgba(0,0,0,.35);
}
html { font-size: 16px; }
body{
  margin:0;
  background:var(--bg);
  color:var(--ink);
  font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
  line-height:1.35;
  letter-spacing:.2px;
  transform-origin: top left;
}
body.neon .primary,
body.neon .fab,
body.neon .date-pill.is-active{
  filter: drop-shadow(0 6px 18px color-mix(in oklab, var(--accent) 50%, transparent));
}
body.metallic .primary,
body.metallic .fab,
body.metallic .date-pill.is-active{
  background-image: linear-gradient(160deg, color-mix(in oklab, var(--accent) 88%, #fff 12%), color-mix(in oklab, var(--accent) 65%, #000 35%));
}

a, button { -webkit-tap-highlight-color: transparent; }

/* ========== Topbar / Titles ========== */
.topbar{
  position:sticky; top:0; z-index:10;
  background:rgba(255,255,255,.55);
  backdrop-filter: blur(var(--blur));
  border-bottom:1px solid var(--line);
  padding:14px 16px 8px;
}
.theme-dark .topbar{ background:rgba(16,18,24,.55); }

.month-title{
  font-family:'Anton', Impact, sans-serif;
  font-size: clamp(22px, 2.6vw, 32px);
  text-transform: uppercase;
  margin:0 48px 6px 0;
  letter-spacing:.5px;
}
.month-nav{
  position:absolute; right:8px; top:10px; display:flex; gap:8px;
}
.icon-btn{
  width:40px; height:40px; border-radius:12px; border:1px solid var(--line);
  background:var(--card); color:var(--ink); display:grid; place-items:center;
  box-shadow: var(--shadow);
}

/* ========== Views Container ========== */
#viewContainer{ padding:12px 12px 86px; }
.view{ display:none; }
.view.is-active{ display:block; }

/* ========== Date scroller (ONLY on Today) ========== */
.date-scroller{
  display:flex; gap:12px; overflow-x:auto; padding:8px 2px 2px;
  scrollbar-width:none;
}
.date-scroller::-webkit-scrollbar{ display:none; }

.date-pill{
  min-width:96px; padding:10px 12px; border-radius:18px;
  background:var(--card); border:1px solid var(--line);
  box-shadow: var(--shadow);
  text-align:center;
}
.date-pill .dow{ font-size:.8rem; color:var(--muted); text-transform:uppercase; }
.date-pill .day{ font-family:'Anton', Impact, sans-serif; font-size:2rem; line-height:1; }
.date-pill .mon{ font-size:.85rem; color:var(--muted); text-transform:capitalize; margin-top:2px; }
.date-pill.is-active{
  background:var(--accent); color:#fff; border-color:transparent;
}

/* ========== Timeline (events) ========== */
.timeline-wrap{
  margin-top:10px;
  background:var(--card); border:1px solid var(--line);
  border-radius: var(--radius-xl); box-shadow: var(--shadow);
  overflow:hidden;
}
.timeline{
  position:relative; height: 520px; /* видимая область */
  overflow:auto;
  background:
   linear-gradient(#0000 31px, var(--line) 32px) repeat-y 0 0/100% 64px;
}
.time-label{
  position:absolute; left:12px; width:56px; text-align:right; color:var(--muted);
  transform:translateY(-50%); font-size:.9rem;
}
.event{
  position:absolute; left:84px; right:12px;
  background: color-mix(in oklab, var(--accent) 10%, var(--card));
  border:1px solid color-mix(in oklab, var(--accent) 40%, var(--line));
  border-left:4px solid var(--accent);
  color:var(--ink);
  border-radius:14px; padding:10px 12px; box-shadow: var(--shadow);
}
.event .ttl{ font-weight:700; margin-bottom:4px; }
.event .meta{ color:var(--muted); font-size:.85rem; }

/* линия "сейчас" */
.now-line{
  position:absolute; left:76px; right:12px; height:2px; background:var(--accent);
  box-shadow:0 0 0 2px color-mix(in oklab, var(--accent) 35%, transparent);
}

/* ========== Task list (swipeable rows) ========== */
.tasklist-wrap{
  margin-top:14px; background:var(--card); border:1px solid var(--line);
  border-radius: var(--radius-xl); box-shadow: var(--shadow);
  padding:8px 0;
  max-height: 520px; overflow:auto;
}
.section-head{ display:flex; justify-content:space-between; align-items:center; padding:12px 16px 6px; }
.section-head h2{ margin:0; font-size:1.15rem; }
.kpi{ color:var(--muted); font-size:.9rem; }

.task-list{ list-style:none; margin:0; padding:0; }
.task-row{
  position:relative; padding:14px 60px 12px 18px; overflow:hidden;
  border-top:1px solid var(--line);
}
.task-row:first-child{ border-top:none; }
.task-row .title{ font-weight:700; }
.task-row .meta{ color:var(--muted); font-size:.9rem; }

.task-actions{ position:absolute; top:50%; right:8px; transform:translateY(-50%); display:flex; gap:8px; }
.icon-small{
  width:34px; height:34px; border-radius:10px; border:1px solid var(--line);
  background:var(--card); display:grid; place-items:center; box-shadow:var(--shadow);
}
.task-done .title{ text-decoration: line-through; opacity:.5; }

/* свайпы */
.swipe-bg{
  position:absolute; inset:0; display:flex; justify-content:space-between; align-items:center;
  padding:0 12px; color:#fff; font-weight:700; pointer-events:none; opacity:0; transition:opacity .15s;
}
.swipe-bg .bg-left{ background:#22c55e; padding:6px 10px; border-radius:10px; }
.swipe-bg .bg-right{ background:#f59e0b; padding:6px 10px; border-radius:10px; }
.task-row.is-swiping .swipe-bg{ opacity:1; }

/* ========== Calendar view ========== */
.cal-head{
  display:grid; grid-template-columns:40px 1fr 40px; align-items:center; gap:12px;
  margin:8px 0 10px;
}
.cal-weekdays{
  display:grid; grid-template-columns: repeat(7, 1fr);
  color:var(--muted); text-align:center; margin:6px 4px 6px;
}
.calendar-wrap{
  background:var(--card); border:1px solid var(--line); box-shadow: var(--shadow);
  border-radius: var(--radius-xl); padding:10px; overflow:auto;
  /* помещаем сетку месяца целиком на экран минус отступы/табар */
  height: calc(100vh - 210px);
}
.calendar-grid{
  display:grid; grid-template-columns: repeat(7, 1fr);
  gap:12px; padding:6px;
}
.cal-cell{
  aspect-ratio: 1 / 1; /* квадрат, адаптивно */
  border:1px solid var(--line); border-radius:14px; background:var(--card);
  display:grid; place-items:center; font-weight:800; font-size:1.05rem;
  box-shadow: var(--shadow);
}
.cal-cell.is-out{ opacity:.45; }
.cal-cell.is-today{ outline:3px solid var(--accent); }
.cal-cell.is-selected{ background:var(--accent); color:#fff; border-color:transparent; }

/* ========== Stats ========== */
.screen-title{ margin:8px 4px 12px; font-family:'Anton', Impact, sans-serif; letter-spacing:.5px; }
.stats-grid{
  display:grid; grid-template-columns: repeat(2, 1fr); gap:12px; padding:6px;
}
.card{
  background:var(--card); border:1px solid var(--line); border-radius:var(--radius-xl);
  box-shadow: var(--shadow); padding:14px;
}
.card-wide{ grid-column: 1 / -1; }
.card-row{ display:flex; justify-content:space-between; align-items:center; margin-bottom:8px; }
.card-caption{ color:var(--muted); font-size:.9rem; }

.ring{ width:100%; max-width:220px; margin:0 auto; position:relative; }
.ring svg{ display:block; width:100%; height:auto; }
.ring-bg{ fill:none; stroke:var(--line); stroke-width:12; }
.ring-fg{
  fill:none; stroke:var(--accent); stroke-width:12; stroke-linecap:round;
  transform: rotate(-90deg); transform-origin: 50% 50%;
  stroke-dasharray: 327; stroke-dashoffset: 327;
  transition: stroke-dashoffset .6s cubic-bezier(.22,1,.36,1);
}
.ring-center{
  position:absolute; inset:0; display:grid; place-items:center; pointer-events:none;
}
.ring-pct{
  font-family:'Anton', Impact, sans-serif; letter-spacing:.5px;
  font-size: clamp(18px, 4.8vw, 28px);
}

/* ========== Bottom Tabbar + FAB ========== */
.tabbar{
  position:fixed; inset:auto 0 0 0; z-index:20; height:64px;
  background:rgba(255,255,255,.7); backdrop-filter: blur(var(--blur));
  border-top:1px solid var(--line);
  display:grid; grid-template-columns: repeat(4, 1fr);
}
.theme-dark .tabbar{ background:rgba(16,18,24,.6); }
.tab{
  border:0; background:transparent; display:grid; place-items:center;
}
.tab.is-active .i{ filter: saturate(1.2); opacity:1; }
.i{ width:22px; height:22px; opacity:.7; }
.i-list{ background: radial-gradient(circle at 30% 30%, var(--ink) 35%, #0000 36%) 0/100% 100%; mask: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="%23000" d="M4 6h16v2H4V6zm0 5h16v2H4v-2zm0 5h16v2H4v-2z"/></svg>') no-repeat center / contain; }
.i-cal{ background: var(--ink); mask:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="%23000" d="M7 2h2v2h6V2h2v2h3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h3V2Zm13 8H4v10h16V10Z"/></svg>') no-repeat center/contain; }
.i-stats{ background: var(--ink); mask:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="%23000" d="M3 3h2v18H3V3Zm4 10h3v8H7v-8Zm5-6h3v14h-3V7Zm5-4h3v18h-3V3Z"/></svg>') no-repeat center/contain; }
.i-gear{ background: var(--ink); mask:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="%23000" d="M12 8a4 4 0 1 1 0 8 4 4 0 0 1 0-8Zm8.94 2.34-1.4-.81.12-1.62-1.58-.92-.92 1.28-1.53-.4L13.9 5h-3.8l-.73 1.87-1.53.4-.92-1.28-1.58.92.12 1.62-1.4.81v3.32l1.4.81-.12 1.62 1.58.92.92-1.28 1.53.4.73 1.87h3.8l.73-1.87 1.53-.4.92 1.28 1.58-.92-.12-1.62 1.4-.81V10.34Z"/></svg>') no-repeat center/contain; }

.fab{
  position:fixed; left:50%; bottom:34px; transform:translateX(-50%);
  width:64px; height:64px; border-radius:50%;
  background:var(--accent); color:#fff; border:0; font-size:30px; line-height:0;
  display:grid; place-items:center; box-shadow: 0 16px 30px color-mix(in oklab, var(--accent) 45%, transparent), 0 6px 10px rgba(0,0,0,.12);
}
.fab:active{ transform:translateX(-50%) scale(.98); }

/* ========== Buttons / Inputs ========== */
.btn{
  border:0; padding:10px 14px; border-radius:12px; font-weight:700; cursor:pointer;
}
.btn.primary{ background:var(--accent); color:#fff; }
.btn.ghost{ background:transparent; color:var(--ink); border:1px solid var(--line); }
.field{ display:grid; gap:6px; }
.field input, .field textarea, .field select{
  width:100%; padding:12px 12px; border-radius:12px; border:1px solid var(--line);
  background:var(--card); color:var(--ink);
}
.grid-2{ display:grid; grid-template-columns: 1fr 1fr; gap:10px; }

/* Segmented control */
.field-row{ display:flex; gap:8px; margin:6px 0 8px; }
.seg{ display:inline-grid; grid-auto-flow:column; gap:8px; align-items:center; }
.seg input{ appearance:none; }
.seg span{
  padding:8px 12px; border:1px solid var(--line); border-radius:10px; background:var(--card);
}
.seg input:checked + span{ background:var(--accent); color:#fff; border-color:transparent; }

/* ========== Modal ========== */
.modal{ border:0; padding:0; background:#0000; }
.modal[open]::backdrop{ background:rgba(0,0,0,.25); backdrop-filter: blur(2px); }
.modal-card{
  width:min(640px, calc(100vw - 24px)); margin:auto; background:var(--card);
  border:1px solid var(--line); border-radius:20px; box-shadow: var(--shadow);
  padding:14px;
}
.modal-head{ display:flex; justify-content:space-between; align-items:center; margin-bottom:6px; }
.modal-head h3{ margin:0; font-size:1.2rem; }
.modal-foot{ display:flex; justify-content:flex-end; gap:8px; margin-top:10px; }

/* ========== Utilities ========== */
.muted{ color:var(--muted); }
.hide{ display:none !important; }

/* ========== Responsive tweaks ========== */
@media (min-width: 768px){
  #viewContainer{ padding:16px 16px 96px; }
  .timeline{ height: 560px; }
  .tasklist-wrap{ max-height: 560px; }
  .stats-grid{ grid-template-columns: repeat(3, 1fr); }
}
