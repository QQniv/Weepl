<!doctype html>
<html lang="ru" class="no-js">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Planner ‚Ä¢ –°–µ–≥–æ–¥–Ω—è</title>
  <meta name="theme-color" content="#0a0a0b" />
  <style>
    :root{
      --bg:#0b0c10;
      --panel:#111318;
      --ink:#e6e6ea;
      --muted:#9aa0a6;
      --accent:#4c8dff;
      --accent-2:#7aa6ff;
      --ok:#35c759;
      --warn:#ff9f0a;
      --danger:#ff453a;
      --shadow: 0 10px 30px rgba(0,0,0,0.35);
      --radius: 16px;
      --radius-sm: 12px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial;
      color:var(--ink);
      background: radial-gradient(1200px 800px at 80% -10%, rgba(76,141,255,0.15), transparent 60%),
                  radial-gradient(800px 600px at 10% 0%, rgba(122,166,255,0.10), transparent 55%),
                  var(--bg);
    }
    a{color:inherit;text-decoration:none}
    .wrap{
      max-width:980px;
      margin:0 auto;
      padding:24px 16px 120px;
    }
    header.appbar{
      position:sticky;top:0;z-index:20;
      backdrop-filter: blur(12px);
      background: rgba(11,12,16,0.6);
      border-bottom:1px solid rgba(255,255,255,0.05);
    }
    .appbar .bar{
      max-width:980px;margin:0 auto;
      padding:12px 16px;display:flex;align-items:center;gap:12px;
    }
    .logo{
      display:flex;align-items:center;gap:10px;font-weight:700;letter-spacing:.3px
    }
    .logo .dot{width:10px;height:10px;border-radius:50%;background:var(--accent);box-shadow:0 0 12px rgba(76,141,255,.8)}
    .spacer{flex:1}
    .btn{
      display:inline-flex;align-items:center;gap:10px;
      padding:10px 14px;border-radius:12px;border:1px solid rgba(255,255,255,0.08);
      background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
      color:var(--ink);cursor:pointer;transition:.2s transform,.2s opacity;
    }
    .btn:active{transform:translateY(1px)}
    .btn-ghost{background:transparent}
    .btn-accent{
      background:linear-gradient(180deg, #4c8dff, #367cff);
      border-color:rgba(0,0,0,0.2);
      color:#fff;
      box-shadow:0 8px 22px rgba(76,141,255,0.35), inset 0 1px 0 rgba(255,255,255,0.2);
    }
    .btn-icon{
      width:42px;height:42px;justify-content:center;padding:0;border-radius:12px;
    }

    /* Headline + filters */
    .headline{
      margin:18px 0 16px;display:flex;flex-wrap:wrap;align-items:center;gap:14px
    }
    .headline h1{
      font-size: clamp(20px, 3.5vw, 28px);
      margin:0;font-weight:800;letter-spacing:.2px
    }
    .filters{
      margin-left:auto;display:flex;gap:8px;flex-wrap:wrap
    }
    .chip{
      font-size:13px;color:var(--muted);
      padding:8px 12px;border-radius:999px;border:1px solid rgba(255,255,255,0.08);
      background:rgba(255,255,255,0.02);
      cursor:pointer;user-select:none;transition:.2s background;
    }
    .chip.active{color:#fff;border-color:rgba(124,167,255,0.5);background:rgba(76,141,255,0.1)}

    /* Day bar */
    .daybar{
      display:flex;align-items:center;gap:10px;flex-wrap:wrap;margin:6px 0 18px;
    }
    .daybar .date{
      padding:10px 14px;border-radius:12px;background:rgba(255,255,255,0.03);
      border:1px solid rgba(255,255,255,0.06);color:var(--muted)
    }
    .daybar .streak{
      margin-left:auto;color:var(--muted);font-size:13px
    }

    /* Grid of event blocks (no dots) */
    .grid{
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap:12px;
    }
    @media (max-width:900px){
      .grid{grid-template-columns: repeat(6, 1fr)}
    }
    @media (max-width:640px){
      .grid{grid-template-columns: repeat(4, 1fr)}
    }

    .card{
      grid-column: span 4;
      background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
      border:1px solid rgba(255,255,255,0.08);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding:14px;
      display:flex;flex-direction:column;gap:10px;
      position:relative;overflow:hidden;
    }
    @media (max-width:900px){ .card{grid-column: span 6} }
    @media (max-width:640px){ .card{grid-column: span 4} }

    .time{
      font-variant-numeric: tabular-nums;
      font-weight:800;
      text-align:center;              /* ‚Üê —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –≤—Ä–µ–º—è –≤–Ω—É—Ç—Ä–∏ –∫–∞—Ä—Ç–æ—á–∫–∏ */
      font-size: clamp(22px, 4.5vw, 28px);
      letter-spacing:.5px;
      margin:2px 0 6px;
    }
    .title{
      text-align:center;
      font-weight:700;
      font-size:15px;
      color:#fff;
    }
    .meta{
      display:flex;justify-content:center;gap:10px;color:var(--muted);font-size:12px
    }
    .tags{
      display:flex;justify-content:center;flex-wrap:wrap;gap:6px;margin-top:2px
    }
    .tag{
      font-size:11px;color:#cfd3d7;border:1px solid rgba(255,255,255,0.1);
      padding:6px 8px;border-radius:999px;background:rgba(255,255,255,0.02)
    }
    .progress{
      height:6px;border-radius:999px;background:rgba(255,255,255,0.06);overflow:hidden;margin-top:4px
    }
    .progress > i{display:block;height:100%;width:0%;background:linear-gradient(90deg, var(--accent), var(--accent-2))}

    .card.now{border-color:rgba(76,141,255,0.5);box-shadow:0 10px 30px rgba(76,141,255,0.25)}
    .card.done{opacity:.7}
    .card.done .title{color:#a7ffb9}

    /* FAB */
    .fab{
      position:fixed;right:18px;bottom:18px;z-index:40
    }
    .fab button{
      width:64px;height:64px;border-radius:20px;
      border:none;cursor:pointer;
      background:linear-gradient(180deg,#4c8dff,#367cff);
      color:#fff;font-size:28px;font-weight:700;line-height:0;
      box-shadow:0 12px 35px rgba(76,141,255,0.45), inset 0 1px 0 rgba(255,255,255,0.25);
      transition:.2s transform;
    }
    .fab button:active{transform:translateY(1px)}

    /* Modal */
    .modal{
      position:fixed;inset:0;display:none;place-items:center;z-index:50;
    }
    .modal.active{display:grid}
    .backdrop{
      position:absolute;inset:0;background:rgba(0,0,0,0.5);
      backdrop-filter: blur(4px);
    }
    .sheet{
      position:relative;z-index:1;width:min(560px,92vw);
      background:var(--panel);border:1px solid rgba(255,255,255,0.08);
      border-radius:20px;padding:18px;box-shadow:var(--shadow)
    }
    .sheet h3{margin:0 0 12px}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .row > .field{flex:1;min-width:160px}
    .field label{display:block;font-size:12px;color:var(--muted);margin:8px 0 6px}
    .field input,.field select,.field textarea{
      width:100%;padding:10px 12px;border-radius:12px;border:1px solid rgba(255,255,255,0.08);
      background:rgba(255,255,255,0.03);color:#fff;outline:none
    }
    .actions{display:flex;justify-content:flex-end;gap:10px;margin-top:12px}

    /* Footer nav */
    nav.tabbar{
      position:fixed;left:0;right:0;bottom:0;z-index:30;
      background:rgba(17,19,24,0.9);backdrop-filter: blur(10px);
      border-top:1px solid rgba(255,255,255,0.08);
    }
    .tabbar .row{
      max-width:980px;margin:0 auto;display:grid;grid-template-columns:repeat(4,1fr);gap:6px;padding:8px
    }
    .tab{
      display:flex;flex-direction:column;align-items:center;gap:6px;
      padding:10px;border-radius:12px;color:var(--muted)
    }
    .tab.active{color:#fff;background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.08)}
    .tab span{font-size:11px}
    .ico{width:22px;height:22px;display:inline-block}

    /* Utility */
    .hide{display:none !important}
  </style>
</head>
<body>
  <header class="appbar">
    <div class="bar">
      <div class="logo"><span class="dot"></span> Planner</div>
      <div class="spacer"></div>
      <a class="btn btn-ghost" href="settings.html" aria-label="–û—Ç–∫—Ä—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</a>
      <button class="btn btn-accent" id="btnToday">–°–µ–≥–æ–¥–Ω—è</button>
    </div>
  </header>

  <div class="wrap" id="app">
    <div class="headline">
      <h1 id="headline">–°–µ–≥–æ–¥–Ω—è</h1>
      <div class="filters">
        <div class="chip active" data-filter="all">–í—Å–µ</div>
        <div class="chip" data-filter="work">–†–∞–±–æ—Ç–∞</div>
        <div class="chip" data-filter="study">–£—á—ë–±–∞</div>
        <div class="chip" data-filter="life">–õ–∏—á–Ω–æ–µ</div>
      </div>
    </div>

    <div class="daybar">
      <div class="date" id="dateStr">‚Äî</div>
      <div class="streak" id="streak">–ü—Ä–∏–≤—ã—á–∫–∏: 0üî•</div>
    </div>

    <section class="grid" id="eventsGrid">
      <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è —Å–∫—Ä–∏–ø—Ç–æ–º -->
    </section>
  </div>

  <!-- FAB -->
  <div class="fab">
    <button id="addBtn" title="–î–æ–±–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ">Ôºã</button>
  </div>

  <!-- Modal -->
  <div class="modal" id="modal">
    <div class="backdrop" data-close></div>
    <div class="sheet">
      <h3>–ù–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ</h3>
      <div class="row">
        <div class="field"><label>–ù–∞–∑–≤–∞–Ω–∏–µ</label><input id="fTitle" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –õ–µ–∫—Ü–∏—è, —Å–ø–æ—Ä—Ç–∑–∞–ª‚Ä¶" /></div>
      </div>
      <div class="row">
        <div class="field">
          <label>–î–∞—Ç–∞</label>
          <input id="fDate" type="date" />
        </div>
        <div class="field">
          <label>–í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞</label>
          <input id="fTime" type="time" />
        </div>
        <div class="field">
          <label>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–º–∏–Ω.)</label>
          <input id="fDur" type="number" min="0" step="5" value="60" />
        </div>
      </div>
      <div class="row">
        <div class="field">
          <label>–¢–∏–ø</label>
          <select id="fType">
            <option value="work">–†–∞–±–æ—Ç–∞</option>
            <option value="study">–£—á—ë–±–∞</option>
            <option value="life">–õ–∏—á–Ω–æ–µ</option>
          </select>
        </div>
        <div class="field">
          <label>–ú–µ—Ç–∫–∏ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)</label>
          <input id="fTags" placeholder="–¥–µ–¥–ª–∞–π–Ω, –≤–∞–∂–Ω–æ–µ" />
        </div>
      </div>
      <div class="field">
        <label>–û–ø–∏—Å–∞–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
        <textarea id="fNote" rows="3" placeholder="–ö–æ—Ä–æ—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ‚Ä¶"></textarea>
      </div>
      <div class="actions">
        <button class="btn btn-ghost" data-close>–û—Ç–º–µ–Ω–∞</button>
        <button class="btn btn-accent" id="saveEvent">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      </div>
    </div>
  </div>

  <nav class="tabbar" aria-label="–ù–∏–∂–Ω—è—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è">
    <div class="row">
      <a class="tab active" href="#">
        <span class="ico">üìÖ</span><span>–°–µ–≥–æ–¥–Ω—è</span>
      </a>
      <a class="tab" href="calendar.html">
        <span class="ico">üìÜ</span><span>–ö–∞–ª–µ–Ω–¥–∞—Ä—å</span>
      </a>
      <a class="tab" href="goals.html">
        <span class="ico">üéØ</span><span>–¶–µ–ª–∏</span>
      </a>
      <a class="tab" href="settings.html">
        <span class="ico">‚öôÔ∏è</span><span>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
      </a>
    </div>
  </nav>

  <script>
    // --- Mock storage (–∑–∞–º–µ–Ω–∏–º –Ω–∞ IndexedDB/LocalStorage –ø–æ–∑–∂–µ) ---
    const storeKey = 'planner.events.v1';

    /** @type {Array<{id:string,title:string,date:string,time:string,dur:number,type:string,tags:string[],note?:string,done?:boolean}>} */
    let events = [];

    // –ü—Ä–∏–º–µ—Ä —Å—Ç–∞—Ä—Ç–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π
    const seed = [
      { id: 'e1', title:'–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞', date: tDate(0), time:'08:30', dur:60, type:'life', tags:['–∑–¥–æ—Ä–æ–≤—å–µ'] },
      { id: 'e2', title:'–õ–µ–∫—Ü–∏—è –ø–æ —ç–∫–æ–Ω–æ–º–∏–∫–µ', date: tDate(0), time:'11:00', dur:90, type:'study', tags:['—É–Ω–∏–≤–µ—Ä'] },
      { id: 'e3', title:'–° —Å–æ–∑–≤–æ–Ω–æ–º —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤', date: tDate(0), time:'15:00', dur:45, type:'work', tags:['–≤–∞–∂–Ω–æ'] },
      { id: 'e4', title:'–ß—Ç–µ–Ω–∏–µ/–∫–æ–Ω—Å–ø–µ–∫—Ç', date: tDate(0), time:'20:00', dur:40, type:'study', tags:['—Ñ–æ–∫—É—Å'] },
    ];

    // --- Helpers ---
    function tDate(offsetDays){
      const d = new Date(); d.setDate(d.getDate()+offsetDays);
      return d.toISOString().slice(0,10);
    }
    function load(){
      try{
        const raw = localStorage.getItem(storeKey);
        events = raw ? JSON.parse(raw) : seed;
      }catch{ events = seed; }
    }
    function save(){ localStorage.setItem(storeKey, JSON.stringify(events)); }
    function formatTime(hm){ return hm; } // —É–∂–µ HH:MM
    function minutesBetween(hm, dur){ const [h,m]=hm.split(':').map(Number); const dt=new Date(); dt.setHours(h,m,0,0); return { start:dt, end:new Date(dt.getTime()+dur*60000) }; }
    function isToday(str){ return str === tDate(0); }
    function nowHM(){
      const d=new Date(); return String(d.getHours()).padStart(2,'0')+':'+String(d.getMinutes()).padStart(2,'0');
    }

    // --- UI ---
    const dateStr = document.getElementById('dateStr');
    const headline = document.getElementById('headline');
    const grid = document.getElementById('eventsGrid');
    const btnToday = document.getElementById('btnToday');

    function renderDateBar(){
      const d = new Date();
      const fmt = d.toLocaleDateString('ru-RU', { weekday:'long', day:'2-digit', month:'long' });
      headline.textContent = '–°–µ–≥–æ–¥–Ω—è';
      dateStr.textContent = fmt.charAt(0).toUpperCase()+fmt.slice(1);
    }

    function render(filter='all'){
      grid.innerHTML = '';
      const today = tDate(0);
      const todays = events
        .filter(e => e.date === today)
        .sort((a,b)=> a.time.localeCompare(b.time));

      const frag = document.createDocumentFragment();
      todays
        .filter(e => filter==='all' ? true : e.type===filter)
        .forEach(e=>{
          const card = document.createElement('article');
          card.className = 'card';
          // ¬´—Ç–æ—á–µ–∫¬ª –Ω–µ—Ç ‚Äî —á–∏—Å—Ç—ã–µ –±–ª–æ–∫–∏. –í—Ä–µ–º—è –ø–æ —Ü–µ–Ω—Ç—Ä—É (—Å–º. CSS .time)
          const now = nowHM();
          if (e.time <= now && now < addMinutes(e.time, e.dur)) card.classList.add('now');
          if (e.done) card.classList.add('done');

          const timeEl = el('div','time', formatTime(e.time));
          const titleEl = el('div','title', e.title);
          const metaEl = el('div','meta', `${e.dur} –º–∏–Ω ¬∑ ${labelOf(e.type)}`);

          const tags = document.createElement('div'); tags.className='tags';
          e.tags.forEach(t=> tags.appendChild(el('span','tag', t)));

          const prog = document.createElement('div'); prog.className='progress';
          const progI = document.createElement('i'); prog.appendChild(progI);

          // –≤—ã—á–∏—Å–ª–∏–º –ø—Ä–æ–≥—Ä–µ—Å—Å, –µ—Å–ª–∏ ¬´—Å–µ–π—á–∞—Å¬ª –º–µ–∂–¥—É start/end
          const {start,end} = minutesBetween(e.time, e.dur);
          const nowMs = Date.now();
          if (nowMs < start.getTime()) {
            progI.style.width = '0%';
          } else if (nowMs > end.getTime()) {
            progI.style.width = '100%';
          } else {
            const p = (nowMs - start.getTime()) / (end.getTime()-start.getTime()) * 100;
            progI.style.width = Math.max(0,Math.min(100,p)) + '%';
          }

          card.append(timeEl, titleEl, metaEl, tags, prog);
          card.addEventListener('dblclick', ()=>toggleDone(e.id));
          frag.appendChild(card);
        });

      if (!frag.childNodes.length){
        const empty = document.createElement('div');
        empty.className='card';
        empty.innerHTML = `
          <div class="time">‚Äî</div>
          <div class="title">–ù–∞ —Å–µ–≥–æ–¥–Ω—è –ø—É—Å—Ç–æ</div>
          <div class="meta">–î–æ–±–∞–≤—å –ø–µ—Ä–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ</div>
        `;
        frag.appendChild(empty);
      }

      grid.appendChild(frag);
    }

    function el(tag, cls, text){ const n=document.createElement(tag); if(cls) n.className=cls; if(text!=null) n.textContent=text; return n; }
    function labelOf(type){
      return type==='work' ? '–†–∞–±–æ—Ç–∞' : type==='study' ? '–£—á—ë–±–∞' : '–õ–∏—á–Ω–æ–µ';
    }
    function addMinutes(hm, mins){
      const [h,m] = hm.split(':').map(Number);
      const d = new Date(); d.setHours(h,m+mins,0,0);
      return String(d.getHours()).padStart(2,'0')+':'+String(d.getMinutes()).padStart(2,'0');
    }
    function toggleDone(id){
      const i = events.findIndex(e=>e.id===id);
      if (i>=0){ events[i].done = !events[i].done; save(); render(activeFilter); }
    }

    // --- Filters ---
    let activeFilter = 'all';
    document.querySelectorAll('.chip').forEach(ch=>{
      ch.addEventListener('click', ()=>{
        document.querySelectorAll('.chip').forEach(c=>c.classList.remove('active'));
        ch.classList.add('active');
        activeFilter = ch.dataset.filter;
        render(activeFilter);
      });
    });

    // --- Modal (–±–µ–∑ ¬´–≤–µ—á–Ω–æ–≥–æ –∑–∞—Ç–µ–º–Ω–µ–Ω–∏—è¬ª: –≤—Å—ë –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ) ---
    const modal = document.getElementById('modal');
    const addBtn = document.getElementById('addBtn');
    const saveEventBtn = document.getElementById('saveEvent');
    const closeEls = modal.querySelectorAll('[data-close]');

    const fTitle = document.getElementById('fTitle');
    const fDate = document.getElementById('fDate');
    const fTime = document.getElementById('fTime');
    const fDur = document.getElementById('fDur');
    const fType = document.getElementById('fType');
    const fTags = document.getElementById('fTags');
    const fNote = document.getElementById('fNote');

    function openModal(){
      fTitle.value=''; fDate.value=tDate(0); fTime.value=nowHM(); fDur.value=60;
      fType.value='work'; fTags.value=''; fNote.value='';
      modal.classList.add('active');
      setTimeout(()=>fTitle.focus(), 0);
    }
    function closeModal(){ modal.classList.remove('active'); }

    addBtn.addEventListener('click', openModal);
    closeEls.forEach(el=> el.addEventListener('click', closeModal));
    modal.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeModal(); });
    modal.addEventListener('click', (e)=>{ if(e.target.matches('.backdrop')) closeModal(); });

    saveEventBtn.addEventListener('click', ()=>{
      const title = (fTitle.value||'').trim();
      if (!title){ fTitle.focus(); return; }
      const rec = {
        id: 'e'+Math.random().toString(36).slice(2,9),
        title,
        date: fDate.value || tDate(0),
        time: fTime.value || '09:00',
        dur: Math.max(5, Number(fDur.value||60)),
        type: fType.value || 'work',
        tags: (fTags.value||'').split(',').map(s=>s.trim()).filter(Boolean),
        note: (fNote.value||'').trim()
      };
      events.push(rec); save(); closeModal(); render(activeFilter);
    });

    // ¬´–°–µ–≥–æ–¥–Ω—è¬ª
    btnToday.addEventListener('click', ()=>{
      renderDateBar();
      render(activeFilter);
      window.scrollTo({top:0, behavior:'smooth'});
    });

    // Init
    load();
    renderDateBar();
    render('all');

    // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å —Ä–∞–∑ –≤ –º–∏–Ω—É—Ç—É
    setInterval(()=>render(activeFilter), 60_000);

  </script>
</body>
</html>
